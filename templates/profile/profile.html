
{% extends "layouts/page.html" %}

{% block content %}

<section id="main-content">
    <div class="card">
        <div class="card-header">
            <h2 class=""> Gamer Profile</h2>
        </div>
        <div class="card-body">

<form method="POST" class="form-horizontal" action="{{ url_for('profile.update_profile')}}" id="profileForm">
    <input type="hidden" name="uid" value="{{ user.uid }}" />

    <div class="form-group">
        <label>Main Game</label>
        <input class="form-control" type="text" value="{{ profile.main_game_id }}" name="main_game_id" readonly/>
    </div>
    <div class="form-group">
        <label>Display Name / Game Name</label>
        <input class="form-control" type="text" value="{{ profile.profile_name }}" name="profile_name" />
    </div>
    <div class="form-group">
        <label>Notes</label>
        <input class="form-control" type="text" value="{{ profile.notes }}" name="notes" />
    </div>
    <div class="form-group">
        <label>Preferred Currency</label>
        <input class="form-control" type="text" value="{{ profile.currency }}" name="currency" />
    </div>
    <div class="form-group">
        {% if profile and profile.main_game_id %}
        <button type="submit" class="btn btn-primary">
            <i class="ti ti-save"> </i>
            Update
        </button>

        <button type="button" class="btn btn-danger" id="deleteButton">
            <i class="ti ti-cut"> </i>
            Delete
        </button>

        <a href="#" class="btn btn-success" data-toggle="modal" data-target="#addPayPalAccount">
            <i class="ti ti-shopping-cart" > </i>
            Add PayPal Account
        </a>

        {% else %}
        <a href="#" class="btn btn-success" data-toggle="modal" data-target="#addGameAccount">
            <i class="ti ti-shopping-cart" > </i>
            Add Game Account
        </a>

        {% endif %}
    </div>
</form>



    </div>
    </div>


</section>
{% include "profile/modal/add_paypal.html" %}
{% include "profile/modal/add_game_account.html" %}
{% endblock %}


{% block scripts %}


<script>
    document.getElementById("deleteButton").addEventListener("click", function() {
        if(confirm("Are you sure you want to delete this profile?")) {
            // Perform AJAX request to the delete endpoint
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "{{ url_for('profile.delete_profile') }}", true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Optionally, handle the response here
                    alert("Profile deleted successfully");
                    // Redirect or perform any other action after deletion
                }
            };
            xhr.send("uid={{ user.uid }}");
        }
    });
</script>

{% endblock %}